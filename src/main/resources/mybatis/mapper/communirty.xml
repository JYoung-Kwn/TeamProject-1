<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mybatis.mapper.community">

	<select id="selectAll" resultType="community">
		select comm_no,comm_cate_nm, comm_date, comm_title, comm_content, comm_hitno, mid
		from community 
		order by comm_date desc 
	</select>
 
 	<select id="selectChat" resultType="community">
      	select comm_no,comm_cate_nm, comm_date, comm_title, comm_content, comm_hitno, member.mid ,comm_cate_nm, comm_cate_no, mnick
		from community,member
		where comm_cate_no = '1' and community.mid=member.mid
		order by comm_date desc 
	</select>
 	
 	<select id="selectTips" resultType="community">
		select comm_no,comm_cate_nm, comm_date, comm_title, comm_content, comm_hitno, member.mid ,comm_cate_nm, comm_cate_no, mnick
		from community,member
		where comm_cate_no = '2' and community.mid=member.mid
		order by comm_date desc 
	</select>
 
	<select id="selectBoast" resultType="community">
			select comm_no,comm_cate_nm, comm_date, comm_title, comm_content, comm_hitno, member.mid ,comm_cate_nm, comm_cate_no, mnick
		from community,member
		where comm_cate_no = '3' and community.mid=member.mid
		order by comm_date desc 
	</select> 
	
	<select id="selectAssign" resultType="community">
			select comm_no,comm_cate_nm, comm_date, comm_title, comm_content, comm_hitno, member.mid ,comm_cate_nm, comm_cate_no, mnick
		from community,member
		where comm_cate_no = '4' and community.mid=member.mid
		order by comm_date desc 
	</select>
 	<!-- 후기 게시판 내용 가져오기 -->
	<select id="selectReviewAll" resultType="review">
		SELECT  review.review_no, class_cate.class_cate_nm, class.class_cate_no, review_star, review.review_date, review.review_title, review.review_content, review.review_hitno, member.mnick
		FROM REVIEW, CLASS , class_cate , member
		WHERE CLASS.CLASS_NO= review.class_no and class.class_cate_no=class_cate.class_cate_no and review.mid = member.mid
		order by review_date desc
		
	</select>
	
	<select id="selectCatereview1" resultType="review">
		select review_no,class_cate_nm,class_cate_no,review_star,review_date,review_title,review_content,review_hitno,mid
		from(   SELECT  r.review_no, ca.class_cate_nm, c.class_cate_no, r.review_star, r.review_date, r.review_title, r.review_content, r.review_hitno, r.mid
		        FROM REVIEW r, CLASS c, class_cate ca
		        WHERE c.CLASS_NO= r.class_no and c.class_cate_no=ca.class_cate_no)
		where class_cate_no=1
		order by review_date desc
	</select>
	
	<select id="selectCatereview2" resultType="review">
		select review_no,class_cate_nm,class_cate_no,review_star,review_date,review_title,review_content,review_hitno,mid
		from(   SELECT  r.review_no, ca.class_cate_nm, c.class_cate_no, r.review_star, r.review_date, r.review_title, r.review_content, r.review_hitno, r.mid
		        FROM REVIEW r, CLASS c, class_cate ca
		        WHERE c.CLASS_NO= r.class_no and c.class_cate_no=ca.class_cate_no)
		where class_cate_no=2
		order by review_date desc
	</select>
		<select id="selectCatereview3" resultType="review">
		select review_no,class_cate_nm,class_cate_no,review_star,review_date,review_title,review_content,review_hitno,mid
		from(   SELECT  r.review_no, ca.class_cate_nm, c.class_cate_no, r.review_star, r.review_date, r.review_title, r.review_content, r.review_hitno, r.mid
		        FROM REVIEW r, CLASS c, class_cate ca
		        WHERE c.CLASS_NO= r.class_no and c.class_cate_no=ca.class_cate_no)
		where class_cate_no=3
		order by review_date desc
	</select>
	
	<!-- community pager -->
	<select id="countAll" resultType="int">
		select count(*) from community
	</select>
	
	<select id="selectByPage" parameterType="communityPager" resultType="community">
	 select rnum, comm_no, comm_date, comm_title, comm_content, comm_hitno, mid , mnick, comm_cate_no,comm_cate_nm
	from (
		select rownum as rnum, comm_no, comm_date, comm_title, comm_content, comm_hitno,mid , mnick ,comm_cate_no,comm_cate_nm
	  	from (
   			select comm_no, comm_date, comm_title, comm_content, comm_hitno, member.mid , member.mnick, comm_cate_no,comm_cate_nm
   			from community, member
            where community.mid = member.mid 
   
   		)
		where rownum &lt;= #{endRowNo}
	)
	where rnum &gt;= #{startRowNo}
	</select>
	
	<!-- review pager -->
	<select id="countReviewAll" resultType="int">
		select count(*) from review
	</select>
	
	<select id="selectByReviewPage" parameterType="reviewPager" resultType="review">
    select rnum, review_no, review_date, review_title, review_content, review_hitno, mnick , class_no,review_star,class_cate_no,class_cate_nm
	from (
		select rownum as rnum, review_no, review_date, review_title, review_content, review_hitno, mnick ,class_no,review_star,class_cate_no,class_cate_nm
	  	from (
   			select review_no, review_date, review_title, review_content, review_hitno,member.mnick ,  class.class_no, review_star, class.class_cate_no, class_cate_nm
   			from review,class,class_cate,member
            where review.class_no= class.class_no 
                  and class_cate.class_cate_no= class.class_cate_no
                  and review.mid = member.mid
   		)
		where rownum &lt;= #{endRowNo} 
	)
	where rnum &gt;= #{startRowNo}
	</select>
	
	<!-- detailpage -->
	<select id="selectByComno" parameterType="int" resultType="community">
		select comm_no, comm_date, comm_title, comm_content,comm_hitno, member.mid, member.mnick,comm_cate_no, comm_cate_nm
		from community, member
		where community.mid = member.mid 
          and comm_no = #{comm_no} 
	</select>
	
	<select id="selectByReviewno" parameterType="int" resultType="review">
		 select r.review_no, r.review_date, r.review_title, r.review_content, r.review_hitno, m.mid, m.mnick, c.class_no, r.review_star, ca.class_cate_no, ca.class_cate_nm
		from review r, member m,class c,class_cate ca
		where c.class_cate_no=ca.class_cate_no and r.class_no=c.class_no and r.mid=m.mid
          and r.review_no = #{review_no}
	</select>
	
	<!-- 20.11.26 지은 추가, class_no로 가장 최근 리뷰 두개 조회  -->
	<select id="selectByClassNo" parameterType="int" resultType="review"> 
		select mnick,mpro_img,review_title,review_content,review_date from (
		    select rownum as rnum,mnick,mpro_img,review_title, review_content, review_date from (
		        select member.mnick, member.mpro_img, review_title, review_content, review_date
		        from review, member
		        where review.class_no = #{class_no}
		              and member.mid = review.mid
		        order by review_date desc) 
		    )
		where rnum &lt;= 2
	</select>

	
</mapper>